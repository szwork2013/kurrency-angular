<div class="kurrency-menu" ng-class="{'logged-in': kurrency.auth.loggedIn(), 'open': showing}">
  <ul class="menu-wrapper">
    <li class="sign-in"><a href ng-click="toggle('login')" kurrency-popover="'Sign In'" ng-class="checkClass('login')"><span class="kicon-login"></span></a></li>
    <li class="account"><a href ng-click="toggle('account')" kurrency-popover="'Account'" ng-class="checkClass('account')"><span class="kicon-account"></span></a></li>
    <li class="cart" ng-class="{'cart-empty': cart.length <= 0}"><a href ng-click="toggle('cart')" kurrency-popover="shoppingCartPopoverText" showing="{{cartAddActive}}" ng-class="checkClass('cart')"><span class="kicon-cart"></span><span class="count">{{quantity_total}}</span></a></li>
    <li class="wishlist"><a href ng-click="toggle('wishlist')" kurrency-popover="'Wishlist'" ng-class="checkClass('wishlist')"><span class="kicon-wishlist"></span></a></li>
    <li class="contact"><a href kurrency-popover="'Contact'" ng-click="toggle('contact')" ng-class="checkClass('contact')"><span class="kicon-contact"></span></a></li>
    <li class="sign-out"><a href kurrency-popover="'Sign Out'" ng-click="kurrency.auth.signOut()"><span class="kicon-sign_out"></span></a></li>
  </ul>
  <div class="kurrency-loading" ng-class="{active: (apiLoading > 0)}"><div class="loading-indicator">Loading...</div></div>
  <div class="kurrency-sidebar kurrency-cart" ng-class="{active: show('cart')}">
    <div class="closer"><a href ng-click="close()"><span class="kicon-close"></span></a></div>
    <div class="kurrency-container">
      <h1>Shopping Cart</h1>
      <div ng-show="!cart || !cart.length">
        <p>You have nothing in your cart</p>
        <button type="button" class="kurrency-button" ng-click="close()">Continue Shopping</button>
      </div>
      <div ng-show="cart && cart.length">
        <ul class="cart-products">
          <li class="cart-product" ng-repeat="product in cart">
            <div class="left">
              <div class="name" ng-bind="product.name"></div>
              <div class="quantity">Count: <input ng-model="product.qty" ng-change="updateQuantity(product)"></div>
            </div>
            <div class="right">
              <div class="price"><span ng-bind="product.price/100 | currency"></span></div>
              <div class="remove"><a href ng-click="removeProduct(product)">remove</a></div>
            </div>
          </li>
          <li class="cart-product total">
            <div class="left">Product Total</div>
            <div class="right product-total">{{product_total/100 | currency}}</div>
          </li>
        </ul>
        <button type="button" class="kurrency-button checkout-button" ng-click="toggle('checkout', 'cart')">Checkout</button>
      </div>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-wishlist" ng-class="{active: show('wishlist')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Wishlist</h1>
      <div ng-show="!wishlist || !wishlist.length">
        <p>You have nothing in your wishlist</p>
        <button type="button" class="kurrency-button" ng-click="close()">Continue Shopping</button>
      </div>
      <div ng-show="wishlist && wishlist.length">
        <ul>
          <li ng-repeat="product in cart">

          </li>
        </ul>
        <button type="button" class="kurrency-button share-wishlist-button" ng-click="toggle('share-wishlist', 'wishlist')">Share my wishlist</button>
      </div>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-login" ng-class="{active: show('login')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Sign In</h1>
      <p>Sign into your Kurrency account.</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['login']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form ng-submit="loginUser()">
        <input class="kurrency-input" type="text" ng-model="login.username" placeholder="Enter your username or email">
        <input class="kurrency-input" type="password" ng-model="login.password" placeholder="Enter your password">
        <button type="submit" class="kurrency-button login-button">Sign In</button>
        <div class="spacer"></div>
        <button type="button" class="kurrency-button small forgot-password" ng-click="toggle('forgot-password', 'login')">Forgot your password?</button>
        <p>Don't have an account?</p>
        <button type="button" class="kurrency-button small register-button" ng-click="toggle('register', 'login')">Register Now</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-forgot-password" ng-class="{active: show('forgot-password')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Forgot My Password</h1>
      <p>Enter your email address and we will send you instructions to reset your password</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['forgot-password']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form ng-submit="forgotPassword()">
        <input class="kurrency-input" type="text" ng-model="forgot.email" placeholder="Enter your email address">
        <button class="kurrency-button send-password-instructions" type="submit" class="login-button">Send Instructions</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-register" ng-class="{active: show('register')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Register</h1>
      <p>Enter the fields below to get started</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['register']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form ng-submit="registerUser()">
        <input class="kurrency-input" type="text" ng-model="register.first_name" placeholder="Enter your first name">
        <input class="kurrency-input" type="text" ng-model="register.last_name" placeholder="Enter your last name">
        <input class="kurrency-input" type="email" ng-model="register.email" placeholder="Enter your email">
        <input class="kurrency-input" type="password" ng-model="register.password" placeholder="Enter a password">
        <button type="submit" class="kurrency-button register-button">Register</button>
        <p>Already have an account?</p>
        <button type="button" class="kurrency-button small login-button" ng-click="toggle('login', 'register')">Sign in now</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-account" ng-class="{active: show('account')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>My Account</h1>
      <div class="alerts">
        <div ng-repeat="alert in messages['account']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <p>Shipping Addresses</p>
      <ul class="addresses-list">
        <li class="address" ng-repeat="address in addressList">
          <div class="clearfix" ng-show="!address.$$editing">
            <div class="left">
              <div><span ng-bind="address.name | limitTo:18"></span></div>
              <div><span ng-bind="(address.email | limitTo:18) + '...'"></span></div>
              <div><span ng-bind="address.phone | limitTo:18"></span></div>
            </div>
            <div class="right">
              <div><span ng-bind="address.address.address_1 | limitTo:18"></span></div>
              <div><span ng-bind="address.address.city + ', ' + address.address.state_code | limitTo:18"></span></div>
              <div><span ng-bind="address.address.postal_code + ', ' + address.address.country_code"></span></div>
            </div>
          </div>
          <div class="edit-holder" ng-show="address.$$editing">
            <form ng-submit="updateAddress(address)">
              <input class="kurrency-input" type="text" ng-model="address.name" placeholder="Your Name">
              <input class="kurrency-input" type="text" ng-model="address.company_name" placeholder="(optional) Company Name">
              <input class="kurrency-input" type="text" ng-model="address.address.address_1" placeholder="Enter your address" ng-change="lookupGeoCode(address.address.address_1, address.address.postal_code, address)">
              <div ng-show="geocodeComplete">
                <input class="kurrency-input" type="text" ng-model="address.address.address_2" placeholder="(optional) Address Line 2">
                <input class="kurrency-input" type="text" ng-model="address.address.city" placeholder="Enter your city">
                <select class="kurrency-input" ng-model="address.address.state_code" ng-options="state.value as state.name for state in stateList"><option value>Select a State</option></select>
                <select class="kurrency-input" ng-model="address.address.country_code" ng-options="country.value as country.name for country in countryList"><option value>Select a Country</option></select>
              </div>
              <input class="kurrency-input" type="text" ng-model="address.address.postal_code" placeholder="Enter your postal/zip code" ng-change="lookupGeoCode(address.address.address_1, address.address.postal_code, address)">
              <button class="kurrency-button small half cancel" ng-click="address.$$editing = false">Cancel</button>
              <button class="kurrency-button small half submit" ng-click="saveAddress(address)">Save</button>
            </form>
          </div>
          <div ng-show="!address.$$editing">
            <button class="kurrency-button small half edit" ng-click="address.$$editing = true">Edit</button>
            <button class="kurrency-button small half delete" ng-click="deleteAddress(address)">Delete</button>
          </div>
        </li>
      </ul>
      <p>Payment Methods</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['payment_methods']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <ul class="payment-methods">
        <li class="payment-method" ng-repeat="payment_method in paymentMethodList">
          <div class="clearfix" ng-show="!payment_method.$$editing">
            <div class="left" ng-bind="payment_method.nickname"></div>
            <div class="right" ng-bind="getPaymentMethodType(payment_method)"></div>
          </div>
          <div class="edit-holder" ng-show="payment_method.$$editing">
            <form ng-submit="updatePaymentMethod(payment_method)">
              <input class="kurrency-input" type="text" ng-model="payment_method.nickname" placeholder="Nickname">
              <button class="kurrency-button small half cancel" ng-click="payment_method.$$editing = false">Cancel</button>
              <button class="kurrency-button small half submit" ng-click="savePaymentMethod(payment_method)">Save</button>
            </form>
          </div>
          <div ng-show="!payment_method.$$editing">
            <button class="kurrency-button small half edit" ng-click="payment_method.$$editing = true">Edit</button>
            <button class="kurrency-button small half delete" ng-click="deletePaymentMethod(payment_method)">Delete</button>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-contact" ng-class="{active: show('contact')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Contact Us</h1>
      <p>Fill out the form below and we'll respond as soon as possible</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['contact']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form ng-submit="sendContact()">
        <input class="kurrency-input" type="text" ng-model="contact.name" placeholder="Enter your name">
        <input class="kurrency-input" type="email" ng-model="contact.email" placeholder="Enter your email">
        <textarea rows="3" class="kurrency-input" ng-model="contact.message" placeholder="Enter a message or concern to send to us"></textarea>
        <button type="submit" class="kurrency-button contact-button">Contact</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-checkout" ng-class="{active: show('checkout')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Checkout</h1>
      <p>Please complete the form below to finish checkout</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['checkout']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form>
        <div ng-show="!kurrency.auth.loggedIn()">
          <p>Have an account?</p>
          <button class="kurrency-button small" type="button" ng-click="toggle('login', 'checkout', 'checkout')">Login Now</button>
        </div>
        <div ng-show="addressList.length > 0">
          <p>Select from a shipping address you have saved</p>
          <select class="kurrency-input" ng-model="checkout.shipment.ship_to" ng-options="address as address.address.address_1 for address in addressList" ng-change="changedAddress()"><option value>New Address</option></select>
        </div>
        <div>
          <p>Enter your email address</p>
          <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.email" placeholder="Your email address">
        </div>
        <div ng-show="requiresShipping">
          <p>Enter a shipping address</p>
          <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.name" placeholder="Your Name">
          <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.company_name" placeholder="(optional) Company Name">
          <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.address.address_1" placeholder="Enter your address" ng-change="lookupGeoCode(checkout.shipment.ship_to.address.address_1, checkout.shipment.ship_to.address.postal_code, checkout.shipment)">
          <div ng-show="geocodeComplete">
            <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.address.address_2" placeholder="(optional) Address Line 2">
            <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.address.city" placeholder="Enter your city">
            <select class="kurrency-input" ng-model="checkout.shipment.ship_to.address.state_code" ng-options="state.value as state.name for state in stateList"><option value>Select a State</option></select>
            <select class="kurrency-input" ng-model="checkout.shipment.ship_to.address.country_code" ng-options="country.value as country.name for country in countryList"><option value>Select a Country</option></select>
          </div>
          <input class="kurrency-input" type="text" ng-model="checkout.shipment.ship_to.address.postal_code" placeholder="Enter your postal/zip code" ng-change="lookupGeoCode(checkout.shipment.ship_to.address.address_1, checkout.shipment.ship_to.address.postal_code, checkout.shipment)">
        </div>
        <button type="submit" class="kurrency-button contact-button" ng-click="saveAddress(checkout.shipment.ship_to); toggle('checkout-2', 'checkout')">Continue</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-checkout" ng-class="{active: show('checkout-2')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back, 'cart')"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Checkout</h1>
      <p>Please complete the form below to finish checkout</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['checkout']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form>
        <div ng-show="addressList.length > 0">
          <p>Select from a billing address you have saved</p>
          <select class="kurrency-input" ng-model="checkout.billing.ship_to" ng-options="address as address.address.address_1 for address in addressList" ng-change="changedAddress()"><option value>New Address</option></select>
        </div>
        <div>
          <button type="button" class="kurrency-button small" ng-click="copyShippingAddress()" ng-hide="shippingAddressCopied">Copy Shipping Address</button>
        </div>
        <div>
          <p>Enter your email address</p>
          <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.email" placeholder="Your email address">
        </div>
        <div>
          <p>Enter a billing address</p>
          <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.name" placeholder="Your Name">
          <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.company_name" placeholder="(optional) Company Name">
          <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.address.address_1" placeholder="Enter your address" ng-change="lookupGeoCode(checkout.billing.ship_to.address.address_1, checkout.billing.ship_to.address.postal_code, checkout.billing)">
          <div ng-show="geocodeComplete">
            <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.address.address_2" placeholder="(optional) Address Line 2">
            <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.address.city" placeholder="Enter your city">
            <select class="kurrency-input" ng-model="checkout.billing.ship_to.address.state_code" ng-options="state.value as state.name for state in stateList"><option value>Select a State</option></select>
            <select class="kurrency-input" ng-model="checkout.billing.ship_to.address.country_code" ng-options="country.value as country.name for country in countryList"><option value>Select a Country</option></select>
          </div>
          <input class="kurrency-input" type="text" ng-model="checkout.billing.ship_to.address.postal_code" placeholder="Enter your postal/zip code" ng-change="lookupGeoCode(checkout.billing.ship_to.address.address_1, checkout.billing.ship_to.address.postal_code, checkout.billing)">
        </div>
        <button type="submit" class="kurrency-button contact-button" ng-click="toggle('checkout-3', 'checkout-2')">Continue</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-checkout" ng-class="{active: show('checkout-3')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back, 'checkout')"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Checkout</h1>
      <p>Please complete the form below to finish checkout</p>
      <div class="alerts">
        <div ng-repeat="alert in messages['checkout']" class="alert-{{alert.type}}">{{alert.message}}</div>
      </div>
      <form>
        <div ng-show="requiresShipping">
          <p>Select a shipping method</p>
          <select class="kurrency-input" ng-model="selectedRate" ng-disabled="rates.length <= 0" ng-options="rate as ((rate.cost | currency) + ' - ' + rate.name) for rate in rates">
            <option value="">Please Wait...</option>
          </select>
        </div>
        <div ng-show="paymentMethodList.length > 0">
          <p>Select a payment method</p>
          <select class="kurrency-input" ng-model="checkout.payment_method" ng-options="payment_method as (getPaymentMethodType(payment_method) + ': ' + payment_method.nickname) for payment_method in paymentMethodList"><option value>New Credit Card</option></select>
        </div>
        <div ng-show="!checkout.payment_method || !checkout.payment_method._id">
          <p>Enter your payment information</p>
          <input class="kurrency-input" type="text" ng-model="checkout.payment_method.card.name" placeholder="Name on card">
          <input class="kurrency-input" type="text" ng-model="checkout.payment_method.card.card_number" placeholder="Card number">
          <select class="kurrency-input" class="expiration" ng-model="checkout.payment_method.card.expiration_month" ng-options="option.value as option.name for option in expirationMonths"><option value>Expiration Month</option></select>
          <select class="kurrency-input" class="expiration" ng-model="checkout.payment_method.card.expiration_year" ng-options="option.value as option.name for option in expirationYears"><option value>Expiration Year</option></select>
          <input class="kurrency-input" type="text" ng-model="checkout.payment_method.card.security_code" placeholder="Security code on back">
        </div>
        <div class="order-total">
          <ul class="cart-products">
            <li class="cart-product total">
              <div class="left">Product Total</div>
              <div class="right product-total">{{product_total/100 | currency}}</div>
            </li>
            <li class="cart-product total">
              <div class="left">Tax Total</div>
              <div class="right product-total">{{tax_total/100 | currency}}</div>
            </li>
            <li class="cart-product total">
              <div class="left">Shipping Total</div>
              <div class="right product-total">{{shipping_total/100 | currency}}</div>
            </li>
            <li class="cart-product final total">
              <div class="left">Final Total</div>
              <div class="right product-total">{{final_total/100 | currency}}</div>
            </li>
          </ul>
        </div>
        <button type="submit" class="kurrency-button contact-button" ng-click="completeOrder()">Complete Order</button>
      </form>
    </div>
  </div>
  <div class="kurrency-sidebar kurrency-checkout" ng-class="{active: show('checkout-complete')}">
    <div class="closer">
      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>
      <a href ng-click="close()"><span class="kicon-close"></span></a>
    </div>
    <div class="kurrency-container">
      <h1>Order Complete!</h1>
      <p>Thank you for placing an order, you should receive an email confirmation soon</p>
      <button type="button" class="kurrency-button" ng-click="close()">Continue Shopping</button>
    </div>
  </div>
</div>