"use strict";!function(a,b){function c(){angular.module("kurrency",[]).constant("kurrencyConfig",{cache:!1,local:!1,accessToken:"ABC123",mode:"test",phrases:{cart_empty:"You don't have anything in your cart"}}).factory("kurrency",["$rootScope","$http","kurrencyConfig",function(a,b,c){function d(c,d){var e=this;if(e.options={},!c)return console.log("Missing Kurrency object");var f={type:"get",url:"",path:"",baseUrl:c.options.baseUrl||"",data:{},dataType:"json",headers:{"Access-Token":c.options.accessToken,"Authentication-Key":c.options.authenticationKey?c.options.authenticationKey:void 0,"Session-Id":c.options.session?c.options.session._id:void 0,"Kurrency-Mode":c.options.mode?c.options.mode:"test"},commonError:function(a){console.log(a)}};return e.config=function(a){return e.options=angular.extend({},f,a),e},e.req=function(c,d,f,g){a.apiLoading=!0;var h=angular.extend({},e.options);h.method=c,h.url=d,"post"===c||"put"===c?(h.data=JSON.stringify(f),h.contentType="application/json"):h.params=f;var i=b(h);return i.success(function(){a.$broadcast("apiFinished",!0)}),i.error(function(b){return a.$broadcast("apiFinished",!0),g?g(b):void a.$broadcast("apiError",b)}),i},e.get=function(a,b,c){return"function"==typeof b&&(c=b,b=null),e.req("get",a,b,c)},e.post=function(a,b,c){return"function"==typeof b&&(c=b,b=null),e.req("post",a,b,c)},e.put=function(a,b,c){return"function"==typeof b&&(c=b,b=null),e.req("put",a,b,c)},e.del=function(a,b,c){return"function"==typeof b&&(c=b,b=null),e.req("delete",a,b,c)},e.config(d)}function e(){var a=this;return"undefined"!=typeof Storage?(a.set=function(a,b){return"object"!=typeof b?(sessionStorage[a]=b,sessionStorage[a]):(sessionStorage[a]=JSON.stringify(b),sessionStorage[a])},a.get=function(a){var b;try{b=JSON.parse(sessionStorage[a])}catch(c){b=sessionStorage[a]}return b},a.remove=function(a){return delete sessionStorage[a],null}):(a.set=function(a,b){var c="",d="object"==typeof b?JSON.stringify(b):escape(b);document.cookie=escape(a)+"="+d+c+"; path=/"},a.get=function(a){for(var b=escape(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b)){var f;try{f=JSON.parse(e.substring(b.length,e.length))}catch(g){f=decodeURIComponent(e.substring(b.length,e.length))}return f}}return null},a.remove=function(b){a.create(b,"",-1)}),a}var f=function(b){function c(a){a&&s.config(a)}function f(a){a&&s.config(a)}function g(a){a&&s.config(a)}function h(a){a&&s.config(a)}function i(a){a&&s.config(a)}function j(a){a&&s.config(a)}function k(a){a&&s.config(a)}function l(a){a&&s.config(a)}function m(a){a&&s.config(a)}function n(a){var b=this;return b.rate=null,b.ship_to={name:void 0,company_name:void 0,attention_to:void 0,email:void 0,phone:void 0,address:{address_1:void 0,address_2:void 0,address_3:void 0,city:void 0,postal_code:void 0,state_code:void 0,country_code:"US"}},b.setRate=function(a){return b.rate=a,b},b.setShipTo=function(a){return b.ship_to.name=a.name,b.ship_to.company_name=a.company_name,b.ship_to.attention_to=a.attention_to,b.ship_to.email=a.email,b.ship_to.phone=a.phone,a.address&&(b.ship_to.address=a.address),b},b.setAddress=function(a){b.ship_to.address=a},b=angular.extend(b,a)}function o(a){var b=this;return b._id=void 0,b.ship_to={name:void 0,company_name:void 0,attention_to:void 0,email:void 0,phone:void 0,address:{address_1:void 0,address_2:void 0,address_3:void 0,city:void 0,postal_code:void 0,state_code:void 0,country_code:"US"}},b.setShipTo=function(a){return b.ship_to.name=a.name,b.ship_to.company_name=a.company_name,b.ship_to.attention_to=a.attention_to,b.ship_to.email=a.email,b.ship_to.phone=a.phone,a.address&&(b.ship_to.address=a.address),b},b.setAddress=function(a){b.ship_to.address=a},b=angular.extend(b,a)}function p(a){var b=this;return b.type="credit_card",b.card={},b.bank_account={},b=angular.extend(b,a)}function q(a){var b=new p({type:"credit_card"});return b._id=void 0,b.card.name=void 0,b.card.card_number=void 0,b.card.expiration_month=(new Date).getMonth()+1,b.card.expiration_year=(new Date).getFullYear(),b.card.security_code=void 0,b.card.postal_code=void 0,b=angular.extend(b,a)}function r(a){var b=new p({type:"bank_account"});return b._id=void 0,b.bank_account.name=void 0,b.bank_account.account_number=void 0,b.bank_account.routing_number=void 0,b.bank_account.type="checking",b=angular.extend(b,a)}var s=this;s.options={},s.Stor=e,s.Request=d;var t=new s.Stor,u={test:"http://0.0.0.0:3458/jsapi",production:"https://api.kurrency.io/api/jsapi"},v={products:{},product_lines:{}};if(!window.angular)throw Error("angular is missing");var w={caching:!0,local:!1,accessToken:"",authenticationKey:null,session:null,mode:"test",baseUrl:u[this.local?"test":"production"]};return s.config=function(a){return s.options=angular.extend(w,a),s.options.baseUrl=s.options.local?u.test:u.production,s},s.handleError=function(b){b&&403===b.responseCode&&(t.remove("session"),s.options.session=null),a.$broadcast("kurrencyError",b)},c.prototype.get=function(a){if(!a)return s.options.session;if(s.options.session=t.get("session"),s.options.session)return a(null,s.options.session);var b=new d(s).get(s.options.baseUrl+"/session",null,s.handleError);b.success(function(b){return s.options.session=b.pkg.data,t.set("session",s.options.session),a(null,s.options.session)})},c.prototype.save=function(a,b){s.options.session=a;var c=new d(s).post(s.options.baseUrl+"/session",a.data,s.handleError);c.success(function(a){return s.options.session=a.pkg.data,t.set("session",s.options.session),b(null,s.options.session)})},f.prototype.get=function(a){s.session.get(function(b,c){c.data.cart||(c.data.cart=[]),s.session.save(c,function(b,c){return a(null,c.data.cart)})})},f.prototype.add=function(a,b,c){s.cart.get(function(d,e){for(var f=0;f<e.length;f++)if(e[f]._id===a._id)return e[f].qty+=parseInt(b),s.session.get(function(a,b){b.data.cart=e,s.session.save(b,function(){return c(null,e)})});e.push({_id:a._id,name:a.name,sub_title:a.sub_title,qty:parseInt(b),image:a.images[0],weight:a.weight,dimensions:a.dimensions,price:a.price,product_lines:a.product_lines}),s.session.get(function(a,b){b.data.cart=e,s.session.save(b,function(){return c(null,e)})})})},f.prototype.update=function(a,b,c){s.cart.get(function(d,e){for(var f=0;f<e.length;f++)if(e[f]._id===a._id){e[f].qty=parseInt(b);break}s.session.get(function(a,b){b.data.cart=e,s.session.save(b,function(){return c(null,e)})})})},f.prototype.remove=function(a,b){s.cart.get(function(c,d){for(var e=0;e<d.length;e++)if(d[e]._id===a._id){d.splice(e,1);break}s.session.get(function(a,c){c.data.cart=d,s.session.save(c,function(){return b(null,d)})})})},f.prototype.empty=function(a){s.session.get(function(b,c){c.data.cart=[],s.session.save(c,function(){return a(null,[])})})},f.prototype.replace=function(a,b){s.session.get(function(c,d){d.data.cart=a,s.session.save(d,function(a,c){return a?b(a,null):b(null,c.data.cart)})})},g.prototype.register=function(a,b){var c=new d(s).post(s.options.baseUrl+"/register",a,s.handleError);c.success(function(a){return t.set("user",a.pkg.data),b(null,a.pkg.data)})},g.prototype.login=function(a,b,c){var e=new d(s).post(s.options.baseUrl+"/login",{username:a,password:b},s.handleError);e.success(function(a){return t.set("user",a.pkg.data),c(null,a.pkg.data)})},g.prototype.signOut=function(){t.remove("session"),t.remove("user"),s.options.session=null,s.options.user=null},g.prototype.loggedIn=function(){return t.get("user")},h.prototype.list=function(a){var b=new d(s).get(s.options.baseUrl+"/addresses",null,s.handleError);b.success(function(b){return a(null,b.pkg.data)})},h.prototype.create=function(a,b){var c=new d(s).post(s.options.baseUrl+"/addresses",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},h.prototype.edit=function(a,b){var c=new d(s).put(s.options.baseUrl+"/addresses",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},h.prototype.remove=function(a,b){var c=new d(s).del(s.options.baseUrl+"/addresses",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},i.prototype.list=function(a){var b=new d(s).get(s.options.baseUrl+"/payment_methods",null,s.handleError);b.success(function(b){return a(null,b.pkg.data)})},i.prototype.create=function(a,b){var c=new d(s).post(s.options.baseUrl+"/payment_methods",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},i.prototype.edit=function(a,b){var c=new d(s).put(s.options.baseUrl+"/payment_methods",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},i.prototype.remove=function(a,b){var c=new d(s).del(s.options.baseUrl+"/payment_methods",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},j.prototype.list=function(a,b){var c=JSON.stringify(a);if(v.products[c])return b(null,v.products[c]);var e=new d(s).get(s.options.baseUrl+"/products",a,s.handleError);e.success(function(a){return s.options.caching===!0&&(v.products[c]=a.pkg.data),b(null,a.pkg.data)})},k.prototype.list=function(a,b){var c=JSON.stringify(a);if(v.product_lines[c])return b(null,v.product_lines[c]);var e=new d(s).get(s.options.baseUrl+"/product-lines",a,s.handleError);e.success(function(a){return s.options.caching===!0&&(v.product_lines[c]=a.pkg.data),b(null,a.pkg.data)})},l.prototype.list=function(a,b){var c=new d(s).get(s.options.baseUrl+"/orders",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},l.prototype.create=function(a,b){var c=new d(s).post(s.options.baseUrl+"/orders",a,s.handleError);c.success(function(a){return b(null,a.pkg.data)})},l.prototype.taxes=function(a,b,c){var e={value:a,ship_to:b.ship_to};s.session.get(function(a){if(a)return c(a,null);var b=new d(s).post(s.options.baseUrl+"/orders/taxes",e,s.handleError);b.success(function(a){return c(null,a.pkg.data)})})},m.prototype.rates=function(a,b){if(!a.products)return b(new Error("Missing products"),null);var c=angular.copy(a);delete c.products,c.packages=[{weight:0,price:0}];for(var e=0;e<a.products.length;e++)c.packages[0].weight+=a.products[e].weight*a.products[e].qty,c.packages[0].price+=a.products[e].price*a.products[e].qty;var f=new d(s).post(s.options.baseUrl+"/shipping/rates",c,s.handleError);f.success(function(a){var c=a.pkg.data;return c.sort(function(a,b){return a.cost-b.cost}),b(null,c)})},s.session=new c,s.cart=new f,s.auth=new g,s.addresses=new h,s.payment_methods=new i,s.products=new j,s.product_lines=new k,s.orders=new l,s.shipping=new m,s.shipment=n,s.customer=o,s.credit_card=q,s.bank_account=r,s.config(b)};return new f(c)}]).directive("kurrencyPopover",function(){return{scope:!0,restrict:"A",transclude:!0,templateUrl:function(a,b){var c="/kurrency-templates/kurrency-popover.html";return b.templateUrl&&(c=b.templateUrl),c},link:function(a,b,c){a.contents=a.$eval(c.kurrencyPopover);var d=angular.element(b[0].querySelector(".kurrency-popover"));b.bind("mouseover",function(){d.addClass("active")}),b.bind("mouseout",function(){d.removeClass("active")})}}}).directive("kurrencyMenu",function(a,b){return{restrict:"E",templateUrl:function(a,b){var c="/kurrency-templates/kurrency-menu.html";return b.templateUrl&&(c=b.templateUrl),c},replace:!0,link:function(c){c.config=b,c.cart=null,c.showing=null,c.back=null,c.login={username:null,password:null},c.register={first_name:null,last_name:null,email:null,password:null},c.forgot={email:null},c.messages={none:[],login:[],"forgot-password":[],register:[],checkout:[],wishlist:[]},c.kurrency=a,a.cart.get(function(a,b){c.cart=b}),c.addMessage=function(a,b){var d=c.showing;d||(d="none"),c.messages[d].push({type:a,message:b})},c.wipeMessages=function(){for(var a in c.messages)c.messages[a]=[]},c.close=function(){c.showing=null},c.toggle=function(a,b){c.showing=c.showing===a?null:a,c.back=b?b:null},c.show=function(a){return a===c.showing},c.loginUser=function(b){c.wipeMessages(),a.auth.login(c.login.username,c.login.password,function(){c.addMessage("success","Successfully logged in"),c.showing=b?b:null})},c.registerUser=function(b){c.wipeMessages(),c.register.confirm_password=c.register.password,a.auth.register(c.register,function(){c.addMessage("success","Account registered, and logged in"),c.showing=b?b:null})},c.forgotPassword=function(){},c.$on("kurrencyError",function(a,b){return console.log(b),b.pkg?void c.addMessage("error",b.pkg.statusMessage):c.addMessage("error","An error occurred connecting to Kurrency's servers, check your connection.")})}}}),a.KURRENCY_CONFIG&&(a.KURRENCY_CONFIG.integrated||angular.injector(["ng","kurrency"]).invoke(["$compile","$rootScope","kurrencyConfig",function(c,d,e){e.cache=a.KURRENCY_CONFIG.CACHE?a.KURRENCY_CONFIG.CACHE:!0,e.accessToken=a.KURRENCY_CONFIG.ACCESS_TOKEN,e.mode=a.KURRENCY_CONFIG.MODE?a.KURRENCY_CONFIG.MODE:"test",e.local=a.KURRENCY_CONFIG.LOCAL?a.KURRENCY_CONFIG.LOCAL:!1,angular.element(b).find("body").append(c("<kurrency-menu></kurrency-menu>")(d))}])),a[KURRENCY_CONFIG.ANGULAR].module("kurrency").run(["$templateCache",function(a){a.put("kurrency-templates/kurrency-menu.html",'<div class="kurrency-menu" ng-class="{\'logged-in\': kurrency.auth.loggedIn(), \'open\': showing}">\n  <ul class="menu-wrapper">\n    <li class="sign-in"><a href ng-click="toggle(\'login\')" kurrency-popover="\'Sign In\'"><span class="kicon-user"></span></a></li>\n    <li class="account"><a href ng-click="toggle(\'account\')" kurrency-popover="\'Account\'"><span class="kicon-user-circle"></span></a></li>\n    <li class="cart"><a href ng-click="toggle(\'cart\')" kurrency-popover="\'Shipping Cart\'"><span class="kicon-cart"></span></a></li>\n    <li class="wishlist"><a href ng-click="toggle(\'wishlist\')" kurrency-popover="\'Wishlist\'"><span class="kicon-wand"></span></a></li>\n    <li class="contact"><a href kurrency-popover="\'Contact\'"><span class="kicon-bubbles"></span></a></li>\n    <li class="sign-out"><a href kurrency-popover="\'Sign Out\'" ng-click="kurrency.auth.signOut()"><span class="kicon-exit"></span></a></li>\n  </ul>\n  <div class="kurrency-sidebar kurrency-cart" ng-class="{active: show(\'cart\')}">\n    <div class="closer"><a href ng-click="close()"><span class="kicon-close"></span></a></div>\n    <div class="kurrency-container">\n      <h1>Shopping Cart</h1>\n    </div>\n  </div>\n  <div class="kurrency-sidebar kurrency-wishlist" ng-class="{active: show(\'wishlist\')}">\n    <div class="closer">\n      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>\n      <a href ng-click="close()"><span class="kicon-close"></span></a>\n    </div>\n    <div class="kurrency-container">\n      <h1>Wishlist</h1>\n    </div>\n  </div>\n  <div class="kurrency-sidebar kurrency-login" ng-class="{active: show(\'login\')}">\n    <div class="closer">\n      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>\n      <a href ng-click="close()"><span class="kicon-close"></span></a>\n    </div>\n    <div class="kurrency-container">\n      <h1>Sign In</h1>\n      <p>Sign into your Kurrency account.</p>\n      <div class="alerts">\n        <div ng-repeat="alert in messages[\'login\']" class="alert-{{alert.type}}">{{alert.message}}</div>\n      </div>\n      <form ng-submit="loginUser()">\n        <input class="kurrency-input" type="text" ng-model="login.username" placeholder="Enter your username or email">\n        <input class="kurrency-input" type="password" ng-model="login.password" placeholder="Enter your password">\n        <button type="submit" class="kurrency-button login-button">Sign In</button>\n        <button type="button" class="kurrency-button small forgot-password" ng-click="toggle(\'forgot-password\', \'login\')">Forgot your password?</button>\n        <p>Don\'t have an account?</p>\n        <button type="button" class="kurrency-button small register-button" ng-click="toggle(\'register\', \'login\')">Register Now</button>\n      </form>\n    </div>\n  </div>\n  <div class="kurrency-sidebar kurrency-forgot-password" ng-class="{active: show(\'forgot-password\')}">\n    <div class="closer">\n      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>\n      <a href ng-click="close()"><span class="kicon-close"></span></a>\n    </div>\n    <div class="kurrency-container">\n      <h1>Forgot My Password</h1>\n      <p>Enter your email address and we will send you instructions to reset your password</p>\n      <div class="alerts">\n        <div ng-repeat="alert in messages[\'forgot-password\']" class="alert-{{alert.type}}">{{alert.message}}</div>\n      </div>\n      <form ng-submit="forgotPassword()">\n        <input class="kurrency-input" type="text" ng-model="forgot.email" placeholder="Enter your email address">\n        <button class="kurrency-button" type="submit" class="login-button">Send Those Instructions</button>\n      </form>\n    </div>\n  </div>\n  <div class="kurrency-sidebar kurrency-register" ng-class="{active: show(\'register\')}">\n    <div class="closer">\n      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>\n      <a href ng-click="close()"><span class="kicon-close"></span></a>\n    </div>\n    <div class="kurrency-container">\n      <h1>Register</h1>\n      <p>Enter the fields below to get started</p>\n      <div class="alerts">\n        <div ng-repeat="alert in messages[\'register\']" class="alert-{{alert.type}}">{{alert.message}}</div>\n      </div>\n      <form ng-submit="registerUser()">\n        <input class="kurrency-input" type="text" ng-model="register.first_name" placeholder="Enter your first name">\n        <input class="kurrency-input" type="text" ng-model="register.last_name" placeholder="Enter your last name">\n        <input class="kurrency-input" type="email" ng-model="register.email" placeholder="Enter your email">\n        <input class="kurrency-input" type="password" ng-model="register.password" placeholder="Enter a password">\n        <button type="submit" class="kurrency-button register-button">Register</button>\n        <p>Already have an account?</p>\n        <button type="button" class="kurrency-button small login-button" ng-click="toggle(\'login\', \'register\')">Sign in now</button>\n      </form>\n    </div>\n  </div>\n  <div class="kurrency-sidebar kurrency-account" ng-class="{active: show(\'account\')}">\n    <div class="closer">\n      <a href class="back" ng-show="back" ng-click="toggle(back)"><span class="kicon-arrow-left"></span></a>\n      <a href ng-click="close()"><span class="kicon-close"></span></a>\n    </div>\n    <div class="kurrency-container">\n      <h1>My Account</h1>\n    </div>\n  </div>\n</div>'),a.put("kurrency-templates/kurrency-popover.html",'<span ng-transclude></span>\n<div class="kurrency-popover">\n  <span ng-bind="contents"></span>\n</div>')}])}if(a.KURRENCY_CONFIG?a.KURRENCY_CONFIG.ANGULAR||(a.KURRENCY_CONFIG.ANGULAR="angular"):a.KURRENCY_CONFIG={ANGULAR:"angular"},a[KURRENCY_CONFIG.ANGULAR]||"undefined"!=typeof a.KURRENCY_CONFIG.REQUIRE_ANGULAR&&a.KURRENCY_CONFIG.REQUIRE_ANGULAR!==!0)c();else{var d=b.createElement("script");d.type="text/javascript",d.async=!0,d.src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.22/angular.min.js",b.getElementsByTagName("body")[0].appendChild(d),d.readyState?d.onreadystatechange=function(){("loaded"==script.readyState||"complete"==script.readyState)&&(script.onreadystatechange=null,c())}:d.onload=function(){c()}}}(window,document);